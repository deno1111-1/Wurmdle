<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Lenis coole Spielesammlung</title>
    <style>
        /* --- GLOBAL --- */
        :root { --col-count: 5; --game-count: 4; }
        body {
            background-color: #121213; color: white;
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            margin: 0; display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden; user-select: none;
        }

        /* HEADER */
        header {
            display: flex; align-items: center; justify-content: space-between;
            width: 100%; padding: 10px 15px; background: #121213;
            border-bottom: 1px solid #333; height: 60px; z-index: 10;
        }
        h1 { margin: 0; font-size: 1.0rem; color: #538d4e; text-shadow: 1px 1px 0 #000; }
        .menu-btn {
            background: #333; color: white; border: 1px solid #555;
            padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.8rem;
        }

        /* --- HAUPTMEN√ú --- */
        #main-menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #121213; z-index: 200;
            display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 20px;
            overflow-y: auto; padding: 20px 0;
        }
        .mode-card {
            background: #1e1e1f; border: 2px solid #538d4e; border-radius: 20px;
            padding: 20px; width: 85%; max-width: 320px; text-align: center;
            cursor: pointer; transition: transform 0.1s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); display: flex; flex-direction: row; align-items: center; gap: 15px;
        }
        .mode-card:active { transform: scale(0.95); }
        .mode-icon { font-size: 3rem; }
        .mode-info { text-align: left; }
        .mode-title { font-size: 1.2rem; font-weight: bold; color: white; }
        .mode-desc { color: #888; font-size: 0.8rem; margin-top: 2px; }

        /* --- LANG SELECT MODAL --- */
        #lang-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 300; display: none;
            flex-direction: column; justify-content: center; align-items: center; gap: 20px;
        }
        .lang-card {
            background: #333; padding: 20px 40px; border-radius: 15px; border: 2px solid #aaa;
            font-size: 1.5rem; font-weight: bold; cursor: pointer; width: 200px; text-align: center;
        }
        .lang-card:hover { background: #444; border-color: white; }

        /* --- SETUP AREA (WORDLE) --- */
        #setup-area {
            flex-grow: 1; display: none; flex-direction: column;
            justify-content: center; align-items: center; gap: 15px;
            width: 100%; padding: 20px; box-sizing: border-box;
        }
        .setting-row { display: flex; flex-direction: column; align-items: center; gap: 5px; width: 100%; }
        .label { color: #888; font-size: 0.9rem; text-transform: uppercase; }
        .toggle-group { display: flex; background: #333; border-radius: 10px; padding: 4px; }
        .lang-btn { background: transparent; border: none; color: #aaa; padding: 10px 20px; font-weight: bold; border-radius: 8px; }
        .lang-btn.active { background: #538d4e; color: white; }
        input[type="number"] {
            padding: 10px; font-size: 1.3rem; width: 100px; text-align: center;
            background: #222; border: 2px solid #538d4e; color: white; border-radius: 10px;
        }
        .start-btn {
            background-color: #538d4e; padding: 15px 50px; font-size: 1.5rem;
            border: none; color: white; font-weight: bold; border-radius: 30px; margin-top: 20px;
            box-shadow: 0 5px 15px rgba(83, 141, 78, 0.4);
        }

        /* --- GAME: WURMDLE --- */
        #game-scroll-area {
            flex-grow: 1; overflow-y: auto; width: 100%; display: none;
            justify-content: center; padding: 20px 0;
        }
        #game-container {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 25px;
            width: 100%; max-width: 1200px; padding-bottom: 50px;
        }
        .board-card {
            background: #1e1e1f; border: 2px solid #444; border-radius: 12px;
            padding: 10px; display: flex; flex-direction: column; align-items: center;
        }
        .board { display: grid; grid-template-columns: repeat(var(--col-count), 1fr); gap: 4px; }
        .tile {
            width: 34px; height: 34px; border: 2px solid #3a3a3c;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.2rem; font-weight: bold; text-transform: uppercase;
            background: #121213; border-radius: 4px;
        }
        .correct { background-color: #538d4e; border-color: #538d4e; }
        .present { background-color: #b59f3b; border-color: #b59f3b; }
        .absent { background-color: #3a3a3c; border-color: #3a3a3c; }
        .shake-effect { animation: shake 0.4s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); border-color: #3a3a3c; }
            20%, 60% { transform: translateX(-5px); border-color: #ff5555; }
            40%, 80% { transform: translateX(5px); border-color: #ff5555; }
        }

        /* --- GAME: LILLY SPELLING (HEX) --- */
        #lilly-area {
            flex-grow: 1; width: 100%; display: none; flex-direction: column;
            align-items: center; padding: 10px; box-sizing: border-box; overflow-y: auto;
        }
        #lilly-input {
            font-size: 2rem; font-weight: bold; color: white; min-height: 50px;
            border-bottom: 2px solid #555; margin-bottom: 20px; text-transform: uppercase;
            width: 80%; text-align: center;
        }
        .cursor { animation: blink 1s infinite; border-right: 2px solid #538d4e; }
        @keyframes blink { 50% { opacity: 0; } }

        #honeycomb {
            display: flex; flex-wrap: wrap; justify-content: center; align-items: center;
            width: 280px; height: 260px; position: relative;
        }
        .hex-btn {
            width: 80px; height: 70px; background: #e0e0e0; color: #121213;
            clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
            display: flex; justify-content: center; align-items: center;
            font-size: 1.8rem; font-weight: bold; cursor: pointer;
            position: absolute; transition: transform 0.1s;
        }
        .hex-btn:active { transform: scale(0.9); }
        .hex-center { background: #ffd700; color: black; z-index: 2; }
        .pos-0 { top: 35%; left: 35%; }
        .pos-1 { top: 5%; left: 35%; }
        .pos-2 { top: 20%; left: 63%; }
        .pos-3 { top: 50%; left: 63%; }
        .pos-4 { top: 65%; left: 35%; }
        .pos-5 { top: 50%; left: 7%; }
        .pos-6 { top: 20%; left: 7%; }

        .game-controls { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; justify-content: center;}
        .action-btn {
            border: 1px solid #555; background: #333; color: white;
            padding: 12px 20px; border-radius: 25px; font-weight: bold; cursor: pointer; font-size: 1rem;
        }
        .hint-btn { background: #3a7bd5; border: none; }
        .finish-btn { background: #ff5555; border: none; width: 100%; margin-top: 10px; max-width: 300px;}

        #lilly-words {
            margin-top: 20px; width: 90%; max-height: 100px; overflow-y: auto;
            border: 1px solid #333; padding: 10px; border-radius: 10px; font-size: 0.9rem; color: #aaa; text-align: center;
        }
        .found-word { display: inline-block; padding: 3px 8px; background: #333; margin: 3px; border-radius: 4px; color: white;}

        /* --- GAME: KLOSSI BOX (LETTER BOXED) --- */
        #klossi-area {
            flex-grow: 1; width: 100%; display: none; flex-direction: column;
            align-items: center; background-color: #f48fb1; /* Pink Background */
            color: #333; position: relative; padding-top: 20px;
        }
        .klossi-header { font-size: 1.5rem; font-weight: bold; margin-bottom: 5px; color: #333; }
        .klossi-sub { font-size: 0.9rem; color: #555; margin-bottom: 20px; }
        
        #box-container {
            width: 300px; height: 300px; position: relative; margin-bottom: 20px;
        }
        /* SVG Layer f√ºr Linien */
        #line-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;
        }
        /* Das Quadrat (Rahmen) */
        .the-box {
            position: absolute; top: 40px; left: 40px; width: 220px; height: 220px;
            border: 4px solid #333; z-index: 0;
        }
        /* Buchstaben Punkte */
        .box-letter {
            width: 30px; height: 30px; border-radius: 50%; background: white;
            position: absolute; display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 1.2rem; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 2; transition: transform 0.1s;
            user-select: none;
        }
        .box-letter:active { transform: scale(0.9); }
        .box-letter.selected { background: #333; color: white; }
        .box-letter.last-active { background: #538d4e; color: white; } /* Startpunkt */

        /* Positionierung der 12 Buchstaben */
        /* Top (0,1,2) */
        .bl-0 { top: 25px; left: 70px; } .bl-1 { top: 25px; left: 135px; } .bl-2 { top: 25px; left: 200px; }
        /* Right (3,4,5) */
        .bl-3 { top: 70px; left: 245px; } .bl-4 { top: 135px; left: 245px; } .bl-5 { top: 200px; left: 245px; }
        /* Bottom (6,7,8) */
        .bl-6 { top: 245px; left: 200px; } .bl-7 { top: 245px; left: 135px; } .bl-8 { top: 245px; left: 70px; }
        /* Left (9,10,11) */
        .bl-9 { top: 200px; left: 25px; } .bl-10 { top: 135px; left: 25px; } .bl-11 { top: 70px; left: 25px; }

        .current-word-display {
            font-size: 1.5rem; font-weight: bold; min-height: 40px; margin-bottom: 10px; text-transform: uppercase;
        }
        .klossi-history {
            font-size: 0.9rem; color: #444; max-width: 90%; text-align: center; line-height: 1.4;
        }

        /* --- HINT MODAL --- */
        #hint-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 600; display: none;
            flex-direction: column; align-items: center; padding: 20px; box-sizing: border-box;
        }
        .hint-table-container { 
            overflow: auto; width: 100%; margin-bottom: 20px; background: #222; border-radius: 8px; max-height: 45vh;
        }
        .hint-table { border-collapse: collapse; color: white; font-size: 0.8rem; width: 100%; }
        .hint-table th, .hint-table td { border: 1px solid #555; padding: 4px; text-align: center; }
        .hint-table th { background: #333; color: #ffd700; position: sticky; top: 0; z-index: 5;}
        .hint-table .row-header { font-weight: bold; background: #222; position: sticky; left: 0; z-index: 6; border-right: 2px solid #555;}
        .hint-table .sum-col { font-weight: bold; color: #aaa; }
        .two-letter-list { 
            display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; width: 100%; 
            margin-bottom: 20px; color: #ddd; font-family: monospace; font-size: 0.9rem; max-height: 30vh; overflow-y: auto;
        }
        .two-letter-item { background: #222; padding: 5px 8px; border-radius: 5px; border: 1px solid #444; flex: 0 0 auto; }
        .two-letter-done { opacity: 0.3; text-decoration: line-through; }

        /* --- STATS MODAL --- */
        #results-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 500; display: none;
            flex-direction: column; align-items: center; padding: 20px; overflow-y: auto;
        }
        .res-header { font-size: 1.5rem; color: #ffd700; margin-bottom: 20px; margin-top: 40px; text-align: center; }
        .res-score-circle {
            width: 120px; height: 120px; border-radius: 50%; border: 5px solid #538d4e;
            display: flex; justify-content: center; align-items: center; font-size: 2.5rem; font-weight: bold;
            margin-bottom: 20px; color: white; background: #222;
        }
        .res-cols { display: flex; width: 100%; max-width: 600px; gap: 10px; flex-grow: 1; }
        .res-col { flex: 1; display: flex; flex-direction: column; border: 1px solid #444; border-radius: 10px; padding: 10px; height: 300px;}
        .res-col h3 { text-align: center; margin: 0 0 10px 0; font-size: 1rem; border-bottom: 1px solid #444; padding-bottom: 5px; }
        .res-list { overflow-y: auto; flex-grow: 1; font-size: 0.9rem; }
        .res-item { padding: 2px 5px; border-bottom: 1px solid #333; }
        .close-res-btn {
            margin-top: 20px; padding: 15px 40px; background: #538d4e; color: white; border: none;
            border-radius: 30px; font-weight: bold; font-size: 1.2rem; cursor: pointer;
        }

        /* --- HUD (SMART) --- */
        #status-panel {
            position: fixed; top: 70px; right: 20px;
            background: rgba(30, 30, 31, 0.95); border: 1px solid #555; border-radius: 8px;
            padding: 10px 15px; display: none; flex-direction: column; gap: 5px; z-index: 100;
            cursor: pointer; transition: all 0.3s ease;
        }
        .status-good { color: #538d4e; font-weight: bold; }
        .status-bad { color: #ff5555; font-weight: bold; }
        #status-panel.minimized {
            width: 40px; height: 40px; padding: 0; border-radius: 50%;
            justify-content: center; align-items: center; background: #333;
        }
        .hud-content { display: flex; flex-direction: column; gap: 5px; width: 100%; }
        .hud-icon { display: none; font-size: 1.5rem; }
        #status-panel.minimized .hud-content { display: none; }
        #status-panel.minimized .hud-icon { display: block; }

        /* --- KEYBOARD --- */
        #keyboard-container {
            display: none; width: 100%; max-width: 800px; padding: 5px;
            background-color: #121213; padding-bottom: 20px; border-top: 1px solid #333;
        }
        .keyboard-row { display: flex; justify-content: center; margin-bottom: 6px; width: 100%; }
        .key {
            position: relative; font-weight: bold; border: 0; padding: 1px; margin: 0 2px; height: 55px;
            border-radius: 4px; cursor: pointer; background-color: #333; color: white;
            flex: 1; font-size: 1.1rem; display: flex; justify-content: center; align-items: center;
        }
        .key-heatmap { position: absolute; top:0; left:0; width:100%; height:100%; display:flex; flex-wrap:wrap; z-index:1; pointer-events:none;}
        .key-pixel { flex-grow:1; flex-basis:calc(100%/4); background:#818384; border:0.5px solid #333; box-sizing:border-box;}
        .key-char { position:relative; z-index:2; pointer-events:none; text-shadow:0 0 3px black;}
        .key-large { flex: 1.5; font-size: 0.8rem; background: #555; }
        
        #msg-toast {
            position: fixed; top: 20%; left: 50%; transform: translateX(-50%);
            background: white; color: black; padding: 15px 30px; border-radius: 30px;
            font-weight: bold; display: none; z-index: 2000; text-align: center;
        }
    </style>
</head>
<body>

    <header>
        <h1>Lenis coole Spielesammlung üéÆ</h1>
        <button class="menu-btn" onclick="location.reload()">HAUPTMEN√ú</button>
    </header>

    <div id="msg-toast">Nachricht</div>

    <div id="main-menu">
        <div class="mode-card" onclick="openWurmdleSetup()">
            <div class="mode-icon">üêõ</div>
            <div class="mode-info">
                <div class="mode-title">Wurmdle</div>
                <div class="mode-desc">Errate das Wort! (DE/EN)</div>
            </div>
        </div>
        <div class="mode-card" onclick="openGameLangSelect('lilly')">
            <div class="mode-icon">üê±</div>
            <div class="mode-info">
                <div class="mode-title">Lillys Spelling Game</div>
                <div class="mode-desc">Finde die W√∂rter (DE/EN)</div>
            </div>
        </div>
        <div class="mode-card" onclick="openGameLangSelect('klossi')">
            <div class="mode-icon">üêà</div>
            <div class="mode-info">
                <div class="mode-title">Klo√üis W√∂rter Box</div>
                <div class="mode-desc">Verbinde die Buchstaben!</div>
            </div>
        </div>
        <div id="loading-msg" style="color:#555; margin-top:20px;">Bereit.</div>
    </div>

    <div id="lang-modal">
        <h2 style="color:white; margin-bottom:30px;">W√§hle deine Sprache:</h2>
        <div class="lang-card" onclick="selectLang('de')">üá©üá™ DEUTSCH</div>
        <div class="lang-card" onclick="selectLang('en')">üá∫üá∏ ENGLISH</div>
        <button class="close-res-btn" style="background:#555; margin-top:30px;" onclick="document.getElementById('lang-modal').style.display='none'">Abbrechen</button>
    </div>

    <div id="status-panel" onclick="toggleHUD()" title="Klicken zum Verkleinern/Vergr√∂√üern">
        <div class="hud-content">
            <div style="display:flex; justify-content:space-between; gap:15px; color:#aaa;">
                <span>Erledigt:</span><span style="color:white; font-weight:bold;" id="hud-progress">0/0</span>
            </div>
            <div style="display:flex; justify-content:space-between; gap:15px; color:#aaa;">
                <span>Versuche:</span><span style="color:white; font-weight:bold;" id="hud-guesses">0</span>
            </div>
            <div style="margin-top:5px; border-top:1px solid #444; padding-top:5px; text-align:center;">
                <span id="hud-status-text" class="status-good">SIEG M√ñGLICH</span>
            </div>
            <div style="text-align:center; font-size:0.7rem; color:#666; margin-top:5px;">(Klick mich)</div>
        </div>
        <div class="hud-icon">üìä</div>
    </div>

    <div id="setup-area">
        <div class="setting-row"><span class="label">Sprache</span>
            <div class="toggle-group">
                <button class="lang-btn active" id="btn-de" onclick="loadWords('de')">DEUTSCH</button>
                <button class="lang-btn" id="btn-en" onclick="loadWords('en')">ENGLISH</button>
            </div>
        </div>
        <div class="setting-row"><span class="label">Anzahl Spiele</span><input type="number" id="board-count" value="4" min="1" max="64"></div>
        <div class="setting-row"><span class="label">Buchstaben</span><input type="number" id="letter-count" value="5"></div>
        <div class="setting-row"><span class="label" style="color:#b59f3b;">+ Extra Versuche</span><input type="number" id="extra-guesses" value="0"></div>
        <button class="start-btn" onclick="startWurmdle()">STARTEN</button>
    </div>

    <div id="game-scroll-area"><div id="game-container"></div></div>

    <div id="lilly-area">
        <div style="color:#ffd700; margin-bottom:10px;">Punkte: <span id="lilly-score">0</span></div>
        <div id="lilly-input"><span id="lilly-text"></span><span class="cursor"></span></div>
        <div id="honeycomb"></div>
        <div class="game-controls">
            <button class="action-btn" onclick="lillyDelete()">‚å´</button>
            <button class="action-btn" onclick="shuffleLilly()">Mischen üîÄ</button>
            <button class="action-btn" style="background:#538d4e;" onclick="lillySubmit()">ENTER</button>
            <button class="action-btn hint-btn" onclick="showHints()">TIPPS üí°</button>
        </div>
        <button class="action-btn finish-btn" onclick="finishLillyGame()">BEENDEN & AUSWERTUNG</button>
        <div id="lilly-words">Gefundene W√∂rter erscheinen hier...</div>
    </div>

    <div id="klossi-area">
        <div class="klossi-header">Klo√üis W√∂rter Box</div>
        <div class="klossi-sub" id="klossi-progress">0 von 12 Buchstaben</div>
        
        <div id="box-container">
            <div class="the-box"></div>
            <svg id="line-layer">
                </svg>
            </div>

        <div class="current-word-display" id="klossi-input"></div>

        <div class="game-controls">
            <button class="action-btn" onclick="klossiDelete()">‚å´</button>
            <button class="action-btn" style="background:#538d4e; padding:12px 40px;" onclick="klossiSubmit()">ENTER</button>
        </div>
        
        <div class="klossi-history" id="klossi-history-list">
            Finde W√∂rter! Verbinde Buchstaben.<br>
            Verwende alle 12 Buchstaben.
        </div>
    </div>

    <div id="hint-modal">
        <div class="res-header" style="margin-top:0;">FEHLENDE W√ñRTER</div>
        <div style="font-size:0.8rem; color:#888; margin-bottom:10px;">(Grid zeigt nur, was noch fehlt!)</div>
        <div class="hint-table-container"><div id="grid-container"></div></div>
        <div style="color:#aaa; margin-bottom:10px;">FEHLENDE ANF√ÑNGE</div>
        <div id="two-letter-container" class="two-letter-list"></div>
        <button class="close-res-btn" onclick="document.getElementById('hint-modal').style.display='none'">SCHLIESSEN</button>
    </div>

    <div id="results-modal">
        <div class="res-header" id="res-header-text">SPIEL BEENDET</div>
        <div class="res-score-circle" id="res-final-score">0</div>
        <div style="color:#aaa; margin-bottom:20px;">PUNKTE (MAX <span id="res-max-pts">0</span>)</div>
        <div class="res-cols">
            <div class="res-col" style="border-color:#538d4e;">
                <h3 style="color:#538d4e;">GEFUNDEN (<span id="count-found">0</span>)</h3>
                <div class="res-list" id="list-found"></div>
            </div>
            <div class="res-col" style="border-color:#ff5555;">
                <h3 style="color:#ff5555;">VERPASST (<span id="count-missed">0</span>)</h3>
                <div class="res-list" id="list-missed"></div>
            </div>
        </div>
        <button class="close-res-btn" onclick="location.reload()">ZUR√úCK ZUM MEN√ú</button>
    </div>

    <div id="keyboard-container"></div>

    <script>
        /* --- DATEN & VARS --- */
        let currentLang = 'de';
        let cleanWordList = [];
        let pendingGame = null; // Welches Spiel wurde gew√§hlt?

        // Wurmdle Vars
        let gameWords=[], games=[], wordLength=5, maxGuesses=6, currentGuess="", isGameActive=false, totalGames=4, activeMode=null;
        // Lilly Vars
        let lillyLetters=[], lillyCenter="", lillyFound=[], lillyScore=0, validLillyWords=[], maxLillyPoints=0;
        // Klo√üi Vars
        let klossiLetters=[], klossiSides=[], klossiUsed=new Set(), klossiCurrentWord="", klossiHistory=[];
        let klossiLastIndex = -1; // Letzter geklickter Index (0-11)

        const keysDE = ["QWERTZUIOP", "ASDFGHJKL", "YXCVBNM"];
        const keysEN = ["QWERTYUIOP", "ASDFGHJKL", "ZXCVBNM"];

        /* --- INIT --- */
        window.onload = () => {
            setTimeout(() => loadWords('de'), 100);
            
            document.addEventListener('keydown', (e) => {
                const key = e.key.toUpperCase();
                if(activeMode === 'wurmdle') {
                    if (key === 'ENTER') { handleKey('ENTER'); e.preventDefault(); }
                    else if (key === 'BACKSPACE') { handleKey('BACK'); e.preventDefault(); }
                    else if (/^[A-Z]$/.test(key) && !e.ctrlKey) { handleKey(key); }
                } else if(activeMode === 'lilly') {
                    if (key === 'ENTER') { lillySubmit(); e.preventDefault(); }
                    else if (key === 'BACKSPACE') { lillyDelete(); e.preventDefault(); }
                    else if (/^[A-Z]$/.test(key) && !e.ctrlKey) { lillyType(key); }
                } else if(activeMode === 'klossi') {
                    if (key === 'ENTER') { klossiSubmit(); e.preventDefault(); }
                    else if (key === 'BACKSPACE') { klossiDelete(); e.preventDefault(); }
                    // Klo√üi hat kein Keyboard Support f√ºr Buchstaben, nur Klick
                }
            });
        };

        function toggleHUD() { document.getElementById('status-panel').classList.toggle('minimized'); }

        async function loadWords(lang) {
            currentLang = lang;
            const msg = document.getElementById('loading-msg');
            msg.innerText = "Lade W√∂rterbuch...";
            if(document.getElementById('btn-de')) {
                document.getElementById('btn-de').className = lang === 'de' ? 'lang-btn active' : 'lang-btn';
                document.getElementById('btn-en').className = lang === 'en' ? 'lang-btn active' : 'lang-btn';
            }
            try {
                const filename = (lang === 'de') ? 'de.txt' : 'en.txt';
                const response = await fetch(filename);
                if (!response.ok) throw new Error("Offline/Fehler");
                const text = await response.text();
                const lines = text.split('\n');
                cleanWordList = [];
                for (let i = 0; i < lines.length; i++) {
                    let w = lines[i].trim().toUpperCase();
                    if (w.length >= 3 && /^[A-Z]+$/.test(w)) { // Klo√üi braucht auch 3er W√∂rter
                        cleanWordList.push(w);
                    }
                }
                msg.innerText = `${cleanWordList.length} W√∂rter bereit.`;
                if(document.querySelector('.start-btn')) document.querySelector('.start-btn').innerText = "STARTEN";
            } catch (error) {
                console.error(error);
                msg.innerText = "Fehler beim Laden!";
                alert("Fehler: " + error.message);
            }
        }

        /* --- NAVIGATION --- */
        async function openWurmdleSetup() {
            await loadWords('de');
            if(cleanWordList.length === 0) return;
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('setup-area').style.display = 'flex';
        }

        function openGameLangSelect(game) {
             pendingGame = game;
             document.getElementById('lang-modal').style.display = 'flex';
        }
        
        function selectLang(lang) {
             document.getElementById('lang-modal').style.display = 'none';
             if(pendingGame === 'lilly') startLillyGame(lang);
             if(pendingGame === 'klossi') startKlossiGame(lang);
        }

        /* ================= WURMDLE LOGIC ================= */
        function startWurmdle() {
            activeMode = 'wurmdle';
            // ... (Wurmdle Setup Code bleibt gleich, nur kopiert)
            totalGames = parseInt(document.getElementById('board-count').value);
            wordLength = parseInt(document.getElementById('letter-count').value);
            const extra = parseInt(document.getElementById('extra-guesses').value) || 0;
            const wList = cleanWordList.filter(w => w.length === wordLength && w.length <= 20);
            gameWords = wList;
            
            if (gameWords.length < totalGames) { alert("Zu wenige W√∂rter!"); return; }
            maxGuesses = wordLength + totalGames + extra;
            if(totalGames > 10 && extra === 0) maxGuesses += 2;
            isGameActive = true;
            document.documentElement.style.setProperty('--col-count', wordLength);
            document.getElementById('setup-area').style.display = 'none';
            document.getElementById('game-scroll-area').style.display = 'flex';
            document.getElementById('keyboard-container').style.display = 'block';
            document.getElementById('status-panel').style.display = 'flex';
            document.getElementById('status-panel').classList.remove('minimized');
            games = []; currentGuess = "";
            const container = document.getElementById('game-container');
            container.innerHTML = '';
            for (let i = 0; i < totalGames; i++) {
                const randomWord = gameWords[Math.floor(Math.random() * gameWords.length)];
                games.push({ id: i, word: randomWord, guesses: [], solved: false });
                let html = `<div class="board-card" id="card-${i}"><div class="board-header"><span>SPIEL ${i+1}</span><button class="help-btn" onclick="giveHint(${i})">üí°</button></div><div class="board" id="board-${i}">`;
                for (let r = 0; r < maxGuesses * wordLength; r++) html += `<div class="tile" id="tile-${i}-${r}"></div>`;
                html += `</div><div class="solution-text" id="sol-${i}"></div></div>`;
                container.innerHTML += html;
            }
            createKeyboard(); updateHUD();
        }
        // ... (Wurmdle Helper Functions - unver√§ndert, unten im Script Block)

        /* ================= LILLY SPELLING LOGIC ================= */
        async function startLillyGame(lang) {
            showToast("Lade W√∂rterbuch...");
            await loadWords(lang);
            if(cleanWordList.length === 0) return;
            activeMode = 'lilly';
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('lilly-area').style.display = 'flex';
            
            let pangrams = cleanWordList.filter(w => new Set(w.split('')).size === 7);
            if(pangrams.length === 0) { alert("Kein Pangramm gefunden"); return; }
            const sourceWord = pangrams[Math.floor(Math.random() * pangrams.length)];
            const uniqueChars = Array.from(new Set(sourceWord.split('')));
            for (let i = uniqueChars.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [uniqueChars[i], uniqueChars[j]] = [uniqueChars[j], uniqueChars[i]];
            }
            lillyCenter = uniqueChars[0];
            lillyLetters = uniqueChars;
            lillyFound = []; lillyScore = 0; maxLillyPoints = 0;
            validLillyWords = cleanWordList.filter(w => {
                if(w.length < 4) return false;
                if(!w.includes(lillyCenter)) return false;
                for(let char of w) if(!lillyLetters.includes(char)) return false;
                return true;
            });
            validLillyWords.forEach(w => maxLillyPoints += calcWordScore(w));
            renderLillyBoard();
            updateLillyScore();
        }
        // ... (Lilly Helper Functions - unver√§ndert, unten)

        /* ================= KLOSSI BOX LOGIC (NEU) ================= */
        async function startKlossiGame(lang) {
            showToast("Lade W√∂rter f√ºr Klo√üi...");
            await loadWords(lang);
            if(cleanWordList.length === 0) return;
            activeMode = 'klossi';
            
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('klossi-area').style.display = 'flex';
            
            // 1. Generator: Finde 12 Buchstaben
            // Einfacher Ansatz: Nimm die h√§ufigsten Buchstaben der Sprache und mische sie
            let frequentChars = (lang==='de') ? "ENISRATOHLDUGCBM" : "ETAOINSHRDLUCMFW"; // Top chars
            // Wir nehmen die ersten 12 und mischen
            let baseChars = frequentChars.substring(0, 12).split('');
            // Mischen
            for (let i = baseChars.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [baseChars[i], baseChars[j]] = [baseChars[j], baseChars[i]];
            }
            klossiLetters = baseChars;
            
            // Seiten zuweisen (0,0,0, 1,1,1, 2,2,2, 3,3,3)
            klossiSides = [0,0,0, 1,1,1, 2,2,2, 3,3,3];
            
            klossiUsed = new Set();
            klossiCurrentWord = "";
            klossiHistory = [];
            klossiLastIndex = -1;
            
            renderKlossiBoard();
            updateKlossiUI();
        }

        function renderKlossiBoard() {
            const container = document.getElementById('box-container');
            // Remove old letters (keep .the-box and svg)
            const old = document.querySelectorAll('.box-letter');
            old.forEach(el => el.remove());
            
            document.getElementById('line-layer').innerHTML = ''; // Clear lines

            klossiLetters.forEach((char, i) => {
                const div = document.createElement('div');
                div.className = `box-letter bl-${i}`;
                div.innerText = char;
                div.id = `k-btn-${i}`;
                div.onclick = () => klossiClick(i);
                container.appendChild(div);
            });
        }

        function klossiClick(idx) {
            // Regel 1: Nicht die gleiche Seite
            if(klossiLastIndex !== -1) {
                const currentSide = Math.floor(idx / 3);
                const lastSide = Math.floor(klossiLastIndex / 3);
                if(currentSide === lastSide) {
                    showToast("Andere Seite w√§hlen!");
                    return;
                }
            }
            // Regel 2: Erstes Wort frei, folgende m√ºssen anschlie√üen
            if(klossiCurrentWord === "" && klossiHistory.length > 0) {
                const lastWord = klossiHistory[klossiHistory.length-1];
                const lastChar = lastWord.charAt(lastWord.length-1);
                if(klossiLetters[idx] !== lastChar) {
                    showToast(`Muss mit '${lastChar}' beginnen!`);
                    return;
                }
            }

            // Draw Line
            if(klossiLastIndex !== -1) {
                drawKlossiLine(klossiLastIndex, idx);
            }

            klossiLastIndex = idx;
            klossiCurrentWord += klossiLetters[idx];
            
            // Visual Feedback
            document.querySelectorAll('.box-letter').forEach(el => el.classList.remove('selected'));
            document.getElementById(`k-btn-${idx}`).classList.add('selected');
            
            updateKlossiUI();
        }

        function drawKlossiLine(fromIdx, toIdx) {
            const fromEl = document.getElementById(`k-btn-${fromIdx}`);
            const toEl = document.getElementById(`k-btn-${toIdx}`);
            
            // Berechne Mitte
            const fRect = fromEl.getBoundingClientRect();
            const tRect = toEl.getBoundingClientRect();
            const cRect = document.getElementById('box-container').getBoundingClientRect();
            
            const x1 = (fRect.left - cRect.left) + 15;
            const y1 = (fRect.top - cRect.top) + 15;
            const x2 = (tRect.left - cRect.left) + 15;
            const y2 = (tRect.top - cRect.top) + 15;

            const line = document.createElementNS('http://www.w3.org/2000/svg','line');
            line.setAttribute('x1', x1); line.setAttribute('y1', y1);
            line.setAttribute('x2', x2); line.setAttribute('y2', y2);
            line.setAttribute('stroke', '#333');
            line.setAttribute('stroke-width', '2');
            document.getElementById('line-layer').appendChild(line);
        }

        function klossiDelete() {
            if(klossiCurrentWord.length > 0) {
                // Remove last char
                klossiCurrentWord = klossiCurrentWord.slice(0, -1);
                // Remove last line
                const svg = document.getElementById('line-layer');
                if(svg.lastChild) svg.removeChild(svg.lastChild);
                
                // Reset active index
                if(klossiCurrentWord.length > 0) {
                    const lastChar = klossiCurrentWord.charAt(klossiCurrentWord.length-1);
                    // Finde den Index dieses Buchstabens (Achtung: Buchstaben k√∂nnen mehrfach vorkommen, wir brauchen den korrekten Pfad)
                    // Da wir das nicht speichern, machen wir einen Trick: Wir suchen irgendeinen Index auf der richtigen Seite? 
                    // Nein, wir m√ºssen eigentlich den Pfad speichern.
                    // Vereinfachung: Bei Delete wird nur der Text gel√∂scht und die Markierung aufgehoben.
                    // F√ºr perfektes Undo br√§uchten wir einen Stack.
                    // Quick fix: Setze lastIndex auf -1 wenn Wort leer, sonst lassen wir es so (User muss neu ansetzen)
                    document.querySelectorAll('.box-letter').forEach(el => el.classList.remove('selected'));
                    // Wir erlauben das Neuanw√§hlen des letzten g√ºltigen Buchstabens nicht direkt (zu komplex ohne Stack).
                    // User muss den letzten Buchstaben nochmal klicken um weiterzumachen? 
                    // Besser: L√∂sche ganzes Wort wenn < 2 Chars
                    if(klossiCurrentWord.length === 0 && klossiHistory.length > 0) {
                         // Zur√ºck zum Startbuchstaben des neuen Wortes
                         const lastWord = klossiHistory[klossiHistory.length-1];
                         const startChar = lastWord.charAt(lastWord.length-1);
                         // Highlight all instances of startChar? No.
                         klossiLastIndex = -1; 
                    } else {
                        // Finde Index des jetzigen letzten Buchstabens? 
                        // Wir machen es einfach: Delete l√∂scht ALLES vom aktuellen Wort.
                        // SVG l√∂schen
                        // document.getElementById('line-layer').innerHTML = ''; // Too aggressive
                    }
                } else {
                    klossiLastIndex = -1;
                    document.querySelectorAll('.box-letter').forEach(el => el.classList.remove('selected'));
                    // Re-Highlight start char if history exists
                    if(klossiHistory.length > 0) {
                        const lastWord = klossiHistory[klossiHistory.length-1];
                        const char = lastWord.charAt(lastWord.length-1);
                        // Finde irgendeinen Index daf√ºr
                        // Optional
                    }
                }
                updateKlossiUI();
            }
        }
        
        // Override delete logic simple: Delete button clears current attempt
        function klossiDelete() {
            klossiCurrentWord = "";
            const svg = document.getElementById('line-layer');
            // Remove lines that correspond to current word only? 
            // Since we don't group them, let's just keep lines permanent for history words?
            // Easy way: Redraw lines for historyWords + currentWord?
            // Let's implement redraw.
            renderKlossiLinesFull();
            
            // Reset logic
            if(klossiHistory.length > 0) {
                const lastWord = klossiHistory[klossiHistory.length-1];
                const char = lastWord.charAt(lastWord.length-1);
                // Find correct index? Logic complex.
                // Allow user to click any instance of that char to continue
                klossiLastIndex = -1; 
                showToast(`W√§hle '${char}' um fortzufahren.`);
            } else {
                klossiLastIndex = -1;
            }
            document.querySelectorAll('.box-letter').forEach(el => el.classList.remove('selected'));
            updateKlossiUI();
        }

        function klossiSubmit() {
            if(klossiCurrentWord.length < 3) { showToast("Zu kurz!"); return; }
            if(!cleanWordList.includes(klossiCurrentWord)) { showToast("Kein g√ºltiges Wort!"); return; }
            
            // Success
            klossiHistory.push(klossiCurrentWord);
            
            // Update Used Set
            klossiCurrentWord.split('').forEach(c => klossiUsed.add(c));
            
            klossiCurrentWord = "";
            klossiLastIndex = -1; // User must click the connection letter explicitly
            
            // Highlight connection letter
            const lastWord = klossiHistory[klossiHistory.length-1];
            const char = lastWord.charAt(lastWord.length-1);
            
            updateKlossiUI();
            
            // Check Win
            if(klossiUsed.size === 12) {
                showToast("üëë SUPER LENI HAT GEWONNEN! üëë");
                // Confetti or visual win?
                document.getElementById('klossi-history-list').innerHTML += '<br><b style="color:green; font-size:1.2rem;">GEWONNEN!</b>';
            }
        }

        function renderKlossiLinesFull() {
            // Clear
            document.getElementById('line-layer').innerHTML = '';
            // Draw history lines would require storing indices. 
            // For this simplified version, lines disappear on Submit (like starting fresh segment), 
            // but the letters remain "used".
            // If we want lines to stay, we need to push [from, to] to a stack.
            // Let's keep it simple: Lines vanish on submit, only word list remains.
        }

        function updateKlossiUI() {
            document.getElementById('klossi-input').innerText = klossiCurrentWord;
            document.getElementById('klossi-progress').innerText = `${klossiUsed.size} von 12 Buchstaben`;
            
            let html = "";
            klossiHistory.forEach((w, i) => {
                html += w;
                if(i < klossiHistory.length - 1) html += " > ";
            });
            if(html === "") html = "Finde W√∂rter! Verbinde Buchstaben.";
            document.getElementById('klossi-history-list').innerHTML = html;
            
            // Gray out used letters? Or mark them?
            // Mark unused ones maybe?
            // Let's mark used ones with opacity? No, keep it clean.
        }

        /* --- WURMDLE FUNCTIONS (COPIED) --- */
        function updateHUD(){
            const s=games.filter(g=>g.solved).length;
            const u=games.length>0?games[0].guesses.length:0;
            const r=maxGuesses-u;
            document.getElementById('hud-progress').innerText=`${s} / ${totalGames}`;
            document.getElementById('hud-guesses').innerText=r;
            const st=document.getElementById('hud-status-text');
            if(r<(totalGames-s)){st.innerText="NICHT SCHAFFBAR";st.className="status-bad";}
            else{st.innerText="SIEG M√ñGLICH";st.className="status-good";}
        }
        function giveHint(id){
            if(!isGameActive)return;
            const g=games[id]; if(g.solved||g.guesses.length>=maxGuesses)return;
            const idx=Math.floor(Math.random()*wordLength);
            showToast(`Tipp: "${g.word[idx]}" an Pos ${idx+1}`);
        }
        function createKeyboard(){
            const kb=document.getElementById('keyboard-container');kb.innerHTML='';
            const lay=(currentLang==='de')?keysDE:keysEN;
            lay.forEach((row,i)=>{
                const d=document.createElement('div');d.className='keyboard-row';
                if(i===lay.length-1) appKey(d,'ENTER','key-large',()=>handleKey('ENTER'));
                for(let c of row){
                    const k=document.createElement('div');k.className='key';k.id=`key-${c}`;k.onclick=()=>handleKey(c);
                    let h=`<div class="key-heatmap">`;for(let j=0;j<totalGames;j++)h+=`<div class="key-pixel" id="pixel-${c}-${j}"></div>`;
                    k.innerHTML=h+`<div class="key-char">${c}</div>`;d.appendChild(k);
                }
                if(i===lay.length-1) appKey(d,'‚å´','key-large',()=>handleKey('BACK'));
                kb.appendChild(d);
            });
        }
        function appKey(p,t,c,a){const b=document.createElement('button');b.className='key '+c;b.innerText=t;b.onclick=a;p.appendChild(b);}
        function handleKey(k){
            if(!isGameActive)return;
            if(k==='ENTER')submitGuess();
            else if(k==='BACK'){currentGuess=currentGuess.slice(0,-1);updateGridPreview();}
            else{if(currentGuess.length<wordLength){currentGuess+=k;updateGridPreview();}}
        }
        function updateGridPreview(){
            games.forEach(g=>{if(g.solved||g.guesses.length>=maxGuesses)return;
            const s=g.guesses.length*wordLength;
            for(let i=0;i<wordLength;i++){
                const t=document.getElementById(`tile-${g.id}-${s+i}`);
                t.innerText=currentGuess[i]||""; t.style.borderColor=currentGuess[i]?"#888":"#3a3a3c";
            }});
        }
        function submitGuess(){
            if(currentGuess.length!==wordLength){showToast("Zu kurz!");return;}
            if(!gameWords.includes(currentGuess)){showToast("Wort unbekannt!");shakeRows();return;}
            games.forEach(g=>{
                if(g.solved||g.guesses.length>=maxGuesses)return;
                const w=g.word.split(''); const u=currentGuess.split('');
                const s=g.guesses.length*wordLength; let st=new Array(wordLength).fill(0);
                for(let i=0;i<wordLength;i++)if(u[i]===w[i]){st[i]=2;w[i]=null;u[i]=null;}
                for(let i=0;i<wordLength;i++)if(u[i]!==null&&w.indexOf(u[i])>-1){st[i]=1;w[w.indexOf(u[i])]=null;}
                for(let i=0;i<wordLength;i++){
                    const t=document.getElementById(`tile-${g.id}-${s+i}`);
                    t.style.borderColor="transparent";
                    if(st[i]===2)t.classList.add('correct');else if(st[i]===1)t.classList.add('present');else t.classList.add('absent');
                }
                g.guesses.push(currentGuess);
                if(currentGuess===g.word){g.solved=true;document.getElementById(`card-${g.id}`).classList.add('solved-overlay');}
            });
            updateKeyboardColors();currentGuess="";updateHUD();
            if(games.every(g=>g.solved||g.guesses.length>=maxGuesses)){
                if(games.every(g=>g.solved))showToast("üéâ SUPER LENI HAT GEWONNEN! üéâ");
                else{showToast("Vorbei!");games.forEach(g=>{if(!g.solved){const el=document.getElementById(`sol-${g.id}`);el.innerText=g.word;el.style.display="block";}});}
                isGameActive=false;
            }
        }
        function shakeRows(){games.forEach(g=>{if(!g.solved&&g.guesses.length<maxGuesses){const s=g.guesses.length*wordLength;for(let i=0;i<wordLength;i++){const t=document.getElementById(`tile-${g.id}-${s+i}`);t.classList.remove('shake-effect');void t.offsetWidth;t.classList.add('shake-effect');}}});}
        function updateKeyboardColors(){
            games.forEach(g=>{
                let st={};
                g.guesses.forEach(gu=>{
                    const w=g.word.split(''); const u=gu.split(''); let l=new Array(wordLength).fill(1);
                    for(let i=0;i<wordLength;i++)if(u[i]===w[i]){l[i]=3;w[i]=null;u[i]=null;}
                    for(let i=0;i<wordLength;i++)if(u[i]&&w.includes(u[i]))l[i]=2;
                    gu.split('').forEach((c,i)=>{if(l[i]>(st[c]||0))st[c]=l[i];});
                });
                for(const[c,s] of Object.entries(st)){const p=document.getElementById(`pixel-${c}-${g.id}`);if(p)p.style.backgroundColor=(s===3)?'#538d4e':(s===2)?'#b59f3b':(s===1)?'#3a3a3c':'#818384';}
            });
        }

        /* --- LILLY HELPERS --- */
        function renderLillyBoard(){
            const c=document.getElementById('honeycomb');c.innerHTML='';
            lillyLetters.forEach((char,i)=>{
                const b=document.createElement('div');b.className=`hex-btn pos-${i}`;
                if(i===0)b.classList.add('hex-center');
                b.innerText=char; b.onclick=()=>lillyType(char); c.appendChild(b);
            });
        }
        function lillyType(c){document.getElementById('lilly-input').innerText+=c;}
        function lillyDelete(){let t=document.getElementById('lilly-input').innerText;document.getElementById('lilly-input').innerText=t.slice(0,-1);}
        function shuffleLilly(){
            let o=lillyLetters.slice(1);
            for(let i=o.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[o[i],o[j]]=[o[j],o[i]];}
            lillyLetters=[lillyLetters[0],...o]; renderLillyBoard();
        }
        function calcWordScore(w){if(w.length===4)return 1;let p=w.length;if(new Set(w.split('')).size===7)p+=7;return p;}
        function lillySubmit(){
            const t=document.getElementById('lilly-input');const w=t.innerText;
            if(w.length<4){showToast("Zu kurz!");return;}
            if(!w.includes(lillyCenter)){showToast("Muss Gelb enthalten!");return;}
            if(lillyFound.includes(w)){showToast("Schon gefunden!");t.innerText="";return;}
            if(validLillyWords.includes(w)){
                const p=calcWordScore(w); lillyFound.push(w); lillyScore+=p; updateLillyScore();
                const s=document.createElement('span');s.className='found-word';s.innerText=w;
                document.getElementById('lilly-words').prepend(s); t.innerText="";
                if(lillyFound.length===validLillyWords.length){showToast("üëë ALLES GEFUNDEN! üëë");setTimeout(()=>finishLillyGame(true),1500);}
            }else{showToast("Nicht in Liste.");t.classList.add('shake-effect');setTimeout(()=>t.classList.remove('shake-effect'),500);}
        }
        function updateLillyScore(){document.getElementById('lilly-score').innerText=`${lillyScore} / ${maxLillyPoints}`;}
        function finishLillyGame(win=false){
            const m=document.getElementById('results-modal');
            const h=document.getElementById('res-header-text');
            h.innerText=win?"SUPER LENI HAT GEWONNEN!":"SPIEL BEENDET";
            h.style.color=win?"#538d4e":"#ffd700";
            const pc=Math.round((lillyScore/maxLillyPoints)*100);
            document.getElementById('res-final-score').innerText=pc;
            document.getElementById('res-max-pts').innerText=maxLillyPoints;
            document.getElementById('count-found').innerText=lillyFound.length;
            document.getElementById('count-missed').innerText=validLillyWords.length-lillyFound.length;
            const lf=document.getElementById('list-found');lf.innerHTML="";
            lillyFound.sort().forEach(w=>lf.innerHTML+=`<div class="res-item" style="color:#538d4e;">${w}</div>`);
            const lm=document.getElementById('list-missed');lm.innerHTML="";
            validLillyWords.filter(w=>!lillyFound.includes(w)).sort().forEach(w=>lm.innerHTML+=`<div class="res-item" style="color:#aaa;">${w}</div>`);
            m.style.display='flex';
        }
        function showHints(){ /* Hint logic identical to prev version, abbreviated for space */
            let mT={},mR={},ls=new Set(),cs=new Set(),tLR={};
            validLillyWords.forEach(w=>{const l=w.length,c=w[0];ls.add(l);cs.add(c);if(!mT[c])mT[c]={};mT[c][l]=(mT[c][l]||0)+1;if(!mR[c])mR[c]={};if(!mR[c][l])mR[c][l]=0;});
            validLillyWords.filter(w=>!lillyFound.includes(w)).forEach(w=>{const l=w.length,c=w[0],tc=w.substring(0,2);if(mR[c])mR[c][l]++;tLR[tc]=(tLR[tc]||0)+1;});
            const sL=Array.from(ls).sort((a,b)=>a-b);const sC=Array.from(cs).sort();
            let h='<table class="hint-table"><thead><tr><th></th>';sL.forEach(l=>h+=`<th>${l}</th>`);h+='<th class="sum-col">Œ£</th></tr></thead><tbody>';
            sC.forEach(c=>{h+=`<tr><td class="row-header">${c}</td>`;let rS=0;sL.forEach(l=>{if(mT[c][l]){const n=mR[c][l];rS+=n;h+=`<td>${n===0?"-":n}</td>`;}else h+='<td></td>';});h+=`<td class="sum-col">${rS}</td></tr>`;});
            h+='</tbody></table>';document.getElementById('grid-container').innerHTML=h;
            let tH="";const all2=new Set();validLillyWords.forEach(w=>all2.add(w.substring(0,2)));
            Array.from(all2).sort().forEach(t=>{const n=tLR[t]||0;const cl=n===0?"two-letter-item two-letter-done":"two-letter-item";tH+=`<div class="${cl}">${t}-${n}</div>`;});
            document.getElementById('two-letter-container').innerHTML=tH;
            document.getElementById('hint-modal').style.display='flex';
        }

        function showToast(txt) {
            const t = document.getElementById('msg-toast'); t.innerText = txt; t.style.display = 'block';
            setTimeout(() => { t.style.display = 'none'; }, 2000);
        }
    </script>
</body>
</html>
