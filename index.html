<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Lenis coole Spielesammlung</title>
    <style>
        /* --- GLOBAL --- */
        :root { --col-count: 5; --game-count: 4; }
        body {
            background-color: #121213; color: white;
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            margin: 0; display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden; user-select: none;
            touch-action: none; /* Verhindert Zoom/Scroll auf dem ganzen Screen */
        }

        /* HEADER */
        header {
            display: flex; align-items: center; justify-content: space-between;
            width: 100%; padding: 10px 15px; background: #121213;
            border-bottom: 1px solid #333; height: 60px; z-index: 10;
        }
        h1 { margin: 0; font-size: 1.0rem; color: #538d4e; text-shadow: 1px 1px 0 #000; }
        .menu-btn {
            background: #333; color: white; border: 1px solid #555;
            padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.8rem;
        }

        /* --- HAUPTMEN√ú --- */
        #main-menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #121213; z-index: 200;
            display: flex; flex-direction: column; justify-content: flex-start; align-items: center; gap: 15px;
            overflow-y: auto; padding: 80px 0 20px 0;
        }
        .mode-card {
            background: #1e1e1f; border: 2px solid #538d4e; border-radius: 20px;
            padding: 15px 20px; width: 85%; max-width: 320px; text-align: left;
            cursor: pointer; transition: transform 0.1s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); display: flex; flex-direction: row; align-items: center; gap: 15px;
            flex-shrink: 0;
        }
        .mode-card:active { transform: scale(0.95); }
        .mode-icon { font-size: 2.5rem; }
        .mode-info { flex-grow: 1; }
        .mode-title { font-size: 1.1rem; font-weight: bold; color: white; }
        .mode-desc { color: #888; font-size: 0.8rem; margin-top: 2px; }

        /* --- ALLGEMEINE CONTROLS --- */
        .game-area {
            flex-grow: 1; width: 100%; display: none; flex-direction: column;
            align-items: center; padding: 10px; box-sizing: border-box; overflow-y: auto;
        }
        .action-btn {
            border: 1px solid #555; background: #333; color: white;
            padding: 12px 20px; border-radius: 25px; font-weight: bold; cursor: pointer; font-size: 1rem;
        }
        .finish-btn { background: #ff5555; border: none; width: 100%; margin-top: 10px; max-width: 300px;}
        .game-controls { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; justify-content: center;}

        /* --- GAME 1: WURMDLE --- */
        #setup-area { display: none; flex-direction: column; align-items: center; gap: 15px; padding: 20px; width: 100%; }
        .setting-row { display: flex; flex-direction: column; align-items: center; gap: 5px; width: 100%; }
        .toggle-group { display: flex; background: #333; border-radius: 10px; padding: 4px; }
        .lang-btn { background: transparent; border: none; color: #aaa; padding: 10px 20px; font-weight: bold; border-radius: 8px; }
        .lang-btn.active { background: #538d4e; color: white; }
        input[type="number"] { padding: 10px; font-size: 1.3rem; width: 100px; text-align: center; background: #222; border: 2px solid #538d4e; color: white; border-radius: 10px; }
        .start-btn { background-color: #538d4e; padding: 15px 50px; font-size: 1.5rem; border: none; color: white; border-radius: 30px; margin-top: 20px; font-weight: bold;}
        
        #game-scroll-area { flex-grow: 1; overflow-y: auto; width: 100%; display: none; justify-content: center; padding: 20px 0; }
        #game-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 25px; width: 100%; max-width: 1200px; padding-bottom: 50px; }
        .board-card { background: #1e1e1f; border: 2px solid #444; border-radius: 12px; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .board { display: grid; grid-template-columns: repeat(var(--col-count), 1fr); gap: 4px; }
        .tile { width: 34px; height: 34px; border: 2px solid #3a3a3c; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; font-weight: bold; text-transform: uppercase; background: #121213; border-radius: 4px; }
        .correct { background-color: #538d4e; border-color: #538d4e; }
        .present { background-color: #b59f3b; border-color: #b59f3b; }
        .absent { background-color: #3a3a3c; border-color: #3a3a3c; }
        .shake-effect { animation: shake 0.4s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); border-color: #3a3a3c; } 20%, 60% { transform: translateX(-5px); border-color: #ff5555; } 40%, 80% { transform: translateX(5px); border-color: #ff5555; } }

        /* --- GAME 2: LILLY SPELLING --- */
        #lilly-input { font-size: 2rem; font-weight: bold; color: white; min-height: 50px; border-bottom: 2px solid #555; margin-bottom: 20px; text-transform: uppercase; width: 80%; text-align: center; }
        #honeycomb { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; width: 280px; height: 260px; position: relative; }
        .hex-btn { width: 80px; height: 70px; background: #e0e0e0; color: #121213; clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); display: flex; justify-content: center; align-items: center; font-size: 1.8rem; font-weight: bold; cursor: pointer; position: absolute; transition: transform 0.1s; }
        .hex-btn:active { transform: scale(0.9); }
        .hex-center { background: #ffd700; color: black; z-index: 2; }
        .pos-0 { top: 35%; left: 35%; } .pos-1 { top: 5%; left: 35%; } .pos-2 { top: 20%; left: 63%; } .pos-3 { top: 50%; left: 63%; } .pos-4 { top: 65%; left: 35%; } .pos-5 { top: 50%; left: 7%; } .pos-6 { top: 20%; left: 7%; }
        #lilly-words { margin-top: 20px; width: 90%; max-height: 100px; overflow-y: auto; border: 1px solid #333; padding: 10px; border-radius: 10px; font-size: 0.9rem; color: #aaa; text-align: center; }
        .found-word { display: inline-block; padding: 3px 8px; background: #333; margin: 3px; border-radius: 4px; color: white;}

        /* --- GAME 3: SCHNECKIS BOX --- */
        #schnecki-area { background-color: #f48fb1; color: #333; }
        .schnecki-header { font-size: 1.5rem; font-weight: bold; margin-bottom: 5px; color: #333; }
        .schnecki-sub { font-size: 0.9rem; color: #555; margin-bottom: 20px; }
        #box-container { width: 300px; height: 300px; position: relative; margin-bottom: 20px; }
        #line-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .the-box { position: absolute; top: 40px; left: 40px; width: 220px; height: 220px; border: 4px solid #333; z-index: 0; }
        .box-letter { width: 30px; height: 30px; border-radius: 50%; background: white; position: absolute; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 1.2rem; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 2; transition: transform 0.1s; user-select: none; }
        .box-letter:active { transform: scale(0.9); }
        .box-letter.selected { background: #333; color: white; }
        /* NEU: Gr√ºne Farbe f√ºr benutzte Buchstaben */
        .box-letter.used { background: #538d4e; color: white; transition: background 0.3s; }

        .bl-0 { top: 25px; left: 70px; } .bl-1 { top: 25px; left: 135px; } .bl-2 { top: 25px; left: 200px; }
        .bl-3 { top: 70px; left: 245px; } .bl-4 { top: 135px; left: 245px; } .bl-5 { top: 200px; left: 245px; }
        .bl-6 { top: 245px; left: 200px; } .bl-7 { top: 245px; left: 135px; } .bl-8 { top: 245px; left: 70px; }
        .bl-9 { top: 200px; left: 25px; } .bl-10 { top: 135px; left: 25px; } .bl-11 { top: 70px; left: 25px; }
        .current-word-display { font-size: 1.5rem; font-weight: bold; min-height: 40px; margin-bottom: 10px; text-transform: uppercase; }
        .schnecki-history { font-size: 0.9rem; color: #444; max-width: 90%; text-align: center; line-height: 1.4; }

        /* --- GAME 4: KLOSSIS LECKERLIJAGD (DOTS) --- */
        #klossi-area { background-color: #222; touch-action: none; }
        .klossi-score-board { display: flex; gap: 20px; margin-bottom: 20px; width: 100%; justify-content: center; }
        .score-box { background: #333; padding: 10px 20px; border-radius: 10px; text-align: center; border: 2px solid transparent; min-width: 80px;}
        .score-box.active { border-color: white; background: #444; transform: scale(1.05); transition: all 0.2s; }
        .p-score { color: #ff69b4; font-weight: bold; font-size: 1.5rem; } /* Rosa */
        .b-score { color: #ffd700; font-weight: bold; font-size: 1.5rem; } /* Gold */
        #dots-canvas-container { position: relative; margin: 0 auto; touch-action: none; display: flex; justify-content: center;}
        #turn-indicator { margin-top: 10px; font-weight: bold; color: #aaa; min-height: 20px;}

        /* --- MODALS --- */
        #lang-modal, #hint-modal, #results-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 600; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; }
        .lang-card { background: #333; padding: 20px 40px; border-radius: 15px; border: 2px solid #aaa; font-size: 1.5rem; font-weight: bold; cursor: pointer; width: 200px; text-align: center; margin-bottom: 20px; }
        .hint-table-container { overflow: auto; width: 100%; margin-bottom: 20px; background: #222; border-radius: 8px; max-height: 45vh; }
        .hint-table { border-collapse: collapse; color: white; font-size: 0.8rem; width: 100%; }
        .hint-table th, .hint-table td { border: 1px solid #555; padding: 4px; text-align: center; }
        .hint-table th { background: #333; color: #ffd700; position: sticky; top: 0; z-index: 5;}
        .hint-table .row-header { font-weight: bold; background: #222; position: sticky; left: 0; z-index: 6; border-right: 2px solid #555;}
        .two-letter-list { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; width: 100%; margin-bottom: 20px; color: #ddd; font-family: monospace; font-size: 0.9rem; max-height: 30vh; overflow-y: auto; }
        .two-letter-item { background: #222; padding: 5px 8px; border-radius: 5px; border: 1px solid #444; flex: 0 0 auto; }
        .two-letter-done { opacity: 0.3; text-decoration: line-through; }
        .res-header { font-size: 1.5rem; color: #ffd700; margin-bottom: 20px; text-align: center; }
        .res-score-circle { width: 120px; height: 120px; border-radius: 50%; border: 5px solid #538d4e; display: flex; justify-content: center; align-items: center; font-size: 2.5rem; font-weight: bold; margin-bottom: 20px; color: white; background: #222; }
        .res-cols { display: flex; width: 100%; max-width: 600px; gap: 10px; flex-grow: 1; }
        .res-col { flex: 1; display: flex; flex-direction: column; border: 1px solid #444; border-radius: 10px; padding: 10px; height: 300px; overflow-y: auto;}
        .close-res-btn { margin-top: 20px; padding: 15px 40px; background: #538d4e; color: white; border: none; border-radius: 30px; font-weight: bold; font-size: 1.2rem; cursor: pointer; }

        /* --- HUD --- */
        #status-panel { position: fixed; top: 70px; right: 20px; background: rgba(30, 30, 31, 0.95); border: 1px solid #555; border-radius: 8px; padding: 10px 15px; display: none; flex-direction: column; gap: 5px; z-index: 100; cursor: pointer; transition: all 0.3s ease; }
        .status-good { color: #538d4e; font-weight: bold; }
        .status-bad { color: #ff5555; font-weight: bold; }
        #status-panel.minimized { width: 40px; height: 40px; padding: 0; border-radius: 50%; justify-content: center; align-items: center; background: #333; }
        .hud-content { display: flex; flex-direction: column; gap: 5px; width: 100%; }
        .hud-icon { display: none; font-size: 1.5rem; }
        #status-panel.minimized .hud-content { display: none; }
        #status-panel.minimized .hud-icon { display: block; }

        /* --- KEYBOARD --- */
        #keyboard-container { display: none; width: 100%; max-width: 800px; padding: 5px; background-color: #121213; padding-bottom: 20px; border-top: 1px solid #333; }
        .keyboard-row { display: flex; justify-content: center; margin-bottom: 6px; width: 100%; }
        .key { position: relative; font-weight: bold; border: 0; padding: 1px; margin: 0 2px; height: 55px; border-radius: 4px; cursor: pointer; background-color: #333; color: white; flex: 1; font-size: 1.1rem; display: flex; justify-content: center; align-items: center; }
        .key-heatmap { position: absolute; top:0; left:0; width:100%; height:100%; display:flex; flex-wrap:wrap; z-index:1; pointer-events:none;}
        .key-pixel { flex-grow:1; flex-basis:calc(100%/4); background:#818384; border:0.5px solid #333; box-sizing:border-box;}
        .key-char { position:relative; z-index:2; pointer-events:none; text-shadow:0 0 3px black;}
        .key-large { flex: 1.5; font-size: 0.8rem; background: #555; }
        
        #msg-toast { position: fixed; top: 20%; left: 50%; transform: translateX(-50%); background: white; color: black; padding: 15px 30px; border-radius: 30px; font-weight: bold; display: none; z-index: 2000; text-align: center; }
    </style>
</head>
<body>

    <header>
        <h1>Lenis coole Spielesammlung üéÆ</h1>
        <button class="menu-btn" onclick="location.reload()">HAUPTMEN√ú</button>
    </header>

    <div id="msg-toast">Nachricht</div>

    <div id="main-menu">
        <div class="mode-card" onclick="openWurmdleSetup()">
            <div class="mode-icon">üêõ</div>
            <div class="mode-info"><div class="mode-title">Wurmdle</div><div class="mode-desc">Errate das Wort! (DE/EN)</div></div>
        </div>
        <div class="mode-card" onclick="openGameLangSelect('lilly')">
            <div class="mode-icon">üê±</div>
            <div class="mode-info"><div class="mode-title">Lillys Spelling Game</div><div class="mode-desc">Finde die W√∂rter (DE/EN)</div></div>
        </div>
        <div class="mode-card" onclick="openGameLangSelect('schnecki')">
            <div class="mode-icon">üêå</div>
            <div class="mode-info"><div class="mode-title">Schneckis W√∂rter Box</div><div class="mode-desc">Verbinde die Buchstaben!</div></div>
        </div>
        <div class="mode-card" onclick="startKlossiGame()">
            <div class="mode-icon">üêà</div>
            <div class="mode-info"><div class="mode-title">Klo√üis Leckerlijagd</div><div class="mode-desc">K√§sek√§stchen vs Klo√üi</div></div>
        </div>
        <div id="loading-msg" style="color:#555; margin-top:10px;">Bereit.</div>
    </div>

    <div id="lang-modal">
        <h2 style="color:white; margin-bottom:30px;">W√§hle deine Sprache:</h2>
        <div class="lang-card" onclick="selectLang('de')">üá©üá™ DEUTSCH</div>
        <div class="lang-card" onclick="selectLang('en')">üá∫üá∏ ENGLISH</div>
        <button class="close-res-btn" style="background:#555; margin-top:30px;" onclick="document.getElementById('lang-modal').style.display='none'">Abbrechen</button>
    </div>

    <div id="status-panel" onclick="toggleHUD()">
        <div class="hud-content">
            <div style="display:flex; justify-content:space-between; gap:15px; color:#aaa;"><span>Erledigt:</span><span style="color:white; font-weight:bold;" id="hud-progress">0/0</span></div>
            <div style="display:flex; justify-content:space-between; gap:15px; color:#aaa;"><span>Versuche:</span><span style="color:white; font-weight:bold;" id="hud-guesses">0</span></div>
            <div style="margin-top:5px; border-top:1px solid #444; padding-top:5px; text-align:center;"><span id="hud-status-text" class="status-good">SIEG M√ñGLICH</span></div>
            <div style="text-align:center; font-size:0.7rem; color:#666; margin-top:5px;">(Klick mich)</div>
        </div>
        <div class="hud-icon">üìä</div>
    </div>

    <div id="setup-area">
        <div class="setting-row"><span class="label">Sprache</span><div class="toggle-group"><button class="lang-btn active" id="btn-de" onclick="loadWords('de')">DEUTSCH</button><button class="lang-btn" id="btn-en" onclick="loadWords('en')">ENGLISH</button></div></div>
        <div class="setting-row"><span class="label">Anzahl Spiele</span><input type="number" id="board-count" value="4" min="1" max="64"></div>
        <div class="setting-row"><span class="label">Buchstaben</span><input type="number" id="letter-count" value="5"></div>
        <div class="setting-row"><span class="label" style="color:#b59f3b;">+ Extra Versuche</span><input type="number" id="extra-guesses" value="0"></div>
        <button class="start-btn" onclick="startWurmdle()">STARTEN</button>
    </div>
    <div id="game-scroll-area"><div id="game-container"></div></div>

    <div id="lilly-area" class="game-area">
        <div style="color:#ffd700; margin-bottom:10px;">Punkte: <span id="lilly-score">0</span></div>
        <div id="lilly-input"><span id="lilly-text"></span><span class="cursor"></span></div>
        <div id="honeycomb"></div>
        <div class="game-controls"><button class="action-btn" onclick="lillyDelete()">‚å´</button><button class="action-btn" onclick="shuffleLilly()">Mischen üîÄ</button><button class="action-btn" style="background:#538d4e;" onclick="lillySubmit()">ENTER</button><button class="action-btn hint-btn" onclick="showHints()">TIPPS üí°</button></div>
        <button class="action-btn finish-btn" onclick="finishLillyGame()">BEENDEN & AUSWERTUNG</button>
        <div id="lilly-words"></div>
    </div>

    <div id="schnecki-area" class="game-area">
        <div class="schnecki-header">Schneckis W√∂rter Box</div>
        <div class="schnecki-sub" id="schnecki-progress">0 von 12 Buchstaben</div>
        <div id="box-container"><div class="the-box"></div><svg id="line-layer"></svg></div>
        <div class="current-word-display" id="schnecki-input"></div>
        <div class="game-controls"><button class="action-btn" onclick="schneckiDelete()">‚å´</button><button class="action-btn" style="background:#538d4e; padding:12px 40px;" onclick="schneckiSubmit()">ENTER</button></div>
        <div class="schnecki-history" id="schnecki-history-list"></div>
    </div>

    <div id="klossi-area" class="game-area">
        <h2 style="color:#ff69b4; margin: 10px 0;">Klo√üis Leckerlijagd</h2>
        <div class="klossi-score-board">
            <div class="score-box" id="sb-player"><div class="p-score" id="score-p">0</div><div>LENI</div></div>
            <div class="score-box" id="sb-bot"><div class="b-score" id="score-b">0</div><div>KLO·∫ûI</div></div>
        </div>
        <div id="turn-indicator">Du bist dran!</div>
        <div id="dots-canvas-container">
            </div>
        <button class="action-btn" style="margin-top:20px;" onclick="startKlossiGame()">NEUES SPIELFELD üé≤</button>
    </div>

    <div id="hint-modal">
        <div class="res-header" style="margin-top:0;">FEHLENDE W√ñRTER</div>
        <div style="font-size:0.8rem; color:#888; margin-bottom:10px;">(Grid zeigt nur, was noch fehlt!)</div>
        <div class="hint-table-container"><div id="grid-container"></div></div>
        <div style="color:#aaa; margin-bottom:10px;">FEHLENDE ANF√ÑNGE</div>
        <div id="two-letter-container" class="two-letter-list"></div>
        <button class="close-res-btn" onclick="document.getElementById('hint-modal').style.display='none'">SCHLIESSEN</button>
    </div>

    <div id="results-modal">
        <div class="res-header" id="res-header-text">SPIEL BEENDET</div>
        <div class="res-score-circle" id="res-final-score">0</div>
        <div style="color:#aaa; margin-bottom:20px;">PUNKTE (MAX <span id="res-max-pts">0</span>)</div>
        <div class="res-cols">
            <div class="res-col" style="border-color:#538d4e;"><h3 style="color:#538d4e;">GEFUNDEN (<span id="count-found">0</span>)</h3><div class="res-list" id="list-found"></div></div>
            <div class="res-col" style="border-color:#ff5555;"><h3 style="color:#ff5555;">VERPASST (<span id="count-missed">0</span>)</h3><div class="res-list" id="list-missed"></div></div>
        </div>
        <button class="close-res-btn" onclick="location.reload()">ZUR√úCK ZUM MEN√ú</button>
    </div>

    <div id="keyboard-container"></div>

    <script>
        /* CONFIG */
        let currentLang='de', cleanWordList=[], pendingGame=null;
        let activeMode=null; 
        const keysDE=["QWERTZUIOP","ASDFGHJKL","YXCVBNM"], keysEN=["QWERTYUIOP","ASDFGHJKL","ZXCVBNM"];

        /* VARS */
        let gameWords=[], games=[], wordLength=5, maxGuesses=6, currentGuess="", totalGames=4;
        let lillyLetters=[], lillyCenter="", lillyFound=[], lillyScore=0, validLillyWords=[], maxLillyPoints=0;
        let schnLetters=[], schnUsed=new Set(), schnCurrent="", schnHistory=[], schnLastIdx=-1;
        
        /* KLOSSI VARS */
        let kDots=6, kH_lines=[], kV_lines=[], kBoxes=[], kTurn=1; // 1=Player(Pink), 2=Bot(Gold)
        let kScoreP=0, kScoreB=0, kCanvas=null, kCtx=null, kScale=1;
        const K_SIZE=50;

        window.onload=()=>{
            setTimeout(()=>loadWords('de'),100);
            document.addEventListener('keydown', handleGlobalKey);
        };

        function handleGlobalKey(e){
            const k=e.key.toUpperCase();
            if(activeMode==='wurmdle'){
                if(k==='ENTER'){handleKey('ENTER');e.preventDefault();}
                else if(k==='BACKSPACE'){handleKey('BACK');e.preventDefault();}
                else if(/^[A-Z]$/.test(k)&&!e.ctrlKey)handleKey(k);
            } else if(activeMode==='lilly'){
                if(k==='ENTER'){lillySubmit();e.preventDefault();}
                else if(k==='BACKSPACE'){lillyDelete();e.preventDefault();}
                else if(/^[A-Z]$/.test(k)&&!e.ctrlKey)lillyType(k);
            } else if(activeMode==='schnecki'){
                if(k==='ENTER'){schneckiSubmit();e.preventDefault();}
                else if(k==='BACKSPACE'){schneckiDelete();e.preventDefault();}
            }
        }

        function toggleHUD(){document.getElementById('status-panel').classList.toggle('minimized');}

        async function loadWords(lang){
            currentLang=lang;
            document.getElementById('loading-msg').innerText="Lade W√∂rterbuch...";
            if(document.getElementById('btn-de')){
                document.getElementById('btn-de').className=lang==='de'?'lang-btn active':'lang-btn';
                document.getElementById('btn-en').className=lang==='en'?'lang-btn active':'lang-btn';
            }
            try{
                const r=await fetch(lang==='de'?'de.txt':'en.txt');
                if(!r.ok)throw new Error("Offline");
                const t=await r.text();
                cleanWordList=[];
                const l=t.split('\n');
                for(let i=0;i<l.length;i++){let w=l[i].trim().toUpperCase();if(w.length>=3&&/^[A-Z]+$/.test(w))cleanWordList.push(w);}
                document.getElementById('loading-msg').innerText="Bereit.";
                if(document.querySelector('.start-btn'))document.querySelector('.start-btn').innerText="STARTEN";
            }catch(e){alert("Fehler beim Laden: "+e.message);}
        }

        async function openWurmdleSetup(){ await loadWords('de'); if(cleanWordList.length===0)return; switchScreen('setup-area'); }
        function openGameLangSelect(g){ pendingGame=g; document.getElementById('lang-modal').style.display='flex'; }
        function selectLang(l){
            document.getElementById('lang-modal').style.display='none';
            if(pendingGame==='lilly')startLillyGame(l);
            if(pendingGame==='schnecki')startSchneckiGame(l);
        }
        function switchScreen(id){
            document.getElementById('main-menu').style.display='none';
            const screens = document.querySelectorAll('.game-area, #setup-area, #game-scroll-area');
            screens.forEach(s=>s.style.display='none');
            document.getElementById(id).style.display = (id==='setup-area' || id.includes('area')) ? 'flex' : 'block';
        }

        /* --- WURMDLE (Shortened for space, logic identical) --- */
        function startWurmdle(){
            activeMode='wurmdle';
            totalGames=parseInt(document.getElementById('board-count').value);
            wordLength=parseInt(document.getElementById('letter-count').value);
            const extra=parseInt(document.getElementById('extra-guesses').value)||0;
            const wList=cleanWordList.filter(w=>w.length===wordLength);
            gameWords=wList;
            if(gameWords.length<totalGames){alert("Zu wenige W√∂rter!");return;}
            maxGuesses=wordLength+totalGames+extra;
            if(totalGames>10&&extra===0)maxGuesses+=2;
            document.documentElement.style.setProperty('--col-count', wordLength);
            switchScreen('game-scroll-area');
            document.getElementById('game-scroll-area').style.display='flex';
            document.getElementById('keyboard-container').style.display='block';
            document.getElementById('status-panel').style.display='flex';
            document.getElementById('status-panel').classList.remove('minimized');
            games=[]; currentGuess="";
            const c=document.getElementById('game-container');c.innerHTML='';
            for(let i=0;i<totalGames;i++){
                const w=gameWords[Math.floor(Math.random()*gameWords.length)];
                games.push({id:i,word:w,guesses:[],solved:false});
                let h=`<div class="board-card" id="card-${i}"><div class="board-header"><span>SPIEL ${i+1}</span><button class="help-btn" onclick="giveHint(${i})">üí°</button></div><div class="board" id="board-${i}">`;
                for(let r=0;r<maxGuesses*wordLength;r++)h+=`<div class="tile" id="tile-${i}-${r}"></div>`;
                h+=`</div><div class="solution-text" id="sol-${i}"></div></div>`;
                c.innerHTML+=h;
            }
            createKeyboard(); updateHUD();
        }
        function giveHint(id){ const g=games[id]; if(g.solved||g.guesses.length>=maxGuesses)return; const idx=Math.floor(Math.random()*wordLength); showToast(`Tipp: "${g.word[idx]}" an Pos ${idx+1}`); }
        function createKeyboard(){
            const kb=document.getElementById('keyboard-container');kb.innerHTML='';
            const lay=(currentLang==='de')?keysDE:keysEN;
            lay.forEach((row,i)=>{
                const d=document.createElement('div');d.className='keyboard-row';
                if(i===lay.length-1) appKey(d,'ENTER','key-large',()=>handleKey('ENTER'));
                for(let c of row){
                    const k=document.createElement('div');k.className='key';k.id=`key-${c}`;k.onclick=()=>handleKey(c);
                    let h=`<div class="key-heatmap">`;for(let j=0;j<totalGames;j++)h+=`<div class="key-pixel" id="pixel-${c}-${j}"></div>`;
                    k.innerHTML=h+`<div class="key-char">${c}</div>`;d.appendChild(k);
                }
                if(i===lay.length-1) appKey(d,'‚å´','key-large',()=>handleKey('BACK'));
                kb.appendChild(d);
            });
        }
        function appKey(p,t,c,a){const b=document.createElement('button');b.className='key '+c;b.innerText=t;b.onclick=a;p.appendChild(b);}
        function handleKey(k){ if(!isGameActive)return; if(k==='ENTER')submitGuess(); else if(k==='BACK'){currentGuess=currentGuess.slice(0,-1);updateGridPreview();} else{if(currentGuess.length<wordLength){currentGuess+=k;updateGridPreview();}} }
        function updateGridPreview(){ games.forEach(g=>{if(g.solved||g.guesses.length>=maxGuesses)return; const s=g.guesses.length*wordLength; for(let i=0;i<wordLength;i++){const t=document.getElementById(`tile-${g.id}-${s+i}`); t.innerText=currentGuess[i]||""; t.style.borderColor=currentGuess[i]?"#888":"#3a3a3c";}}); }
        function submitGuess(){
            if(currentGuess.length!==wordLength){showToast("Zu kurz!");return;}
            if(!gameWords.includes(currentGuess)){showToast("Wort unbekannt!");shakeRows();return;}
            games.forEach(g=>{
                if(g.solved||g.guesses.length>=maxGuesses)return;
                const w=g.word.split(''); const u=currentGuess.split('');
                const s=g.guesses.length*wordLength; let st=new Array(wordLength).fill(0);
                for(let i=0;i<wordLength;i++)if(u[i]===w[i]){st[i]=2;w[i]=null;u[i]=null;}
                for(let i=0;i<wordLength;i++)if(u[i]!==null&&w.indexOf(u[i])>-1){st[i]=1;w[w.indexOf(u[i])]=null;}
                for(let i=0;i<wordLength;i++){const t=document.getElementById(`tile-${g.id}-${s+i}`); t.style.borderColor="transparent"; if(st[i]===2)t.classList.add('correct');else if(st[i]===1)t.classList.add('present');else t.classList.add('absent');}
                g.guesses.push(currentGuess); if(currentGuess===g.word){g.solved=true;document.getElementById(`card-${g.id}`).classList.add('solved-overlay');}
            });
            updateKeyboardColors();currentGuess="";updateHUD();
            if(games.every(g=>g.solved||g.guesses.length>=maxGuesses)){ if(games.every(g=>g.solved))showToast("üéâ SUPER LENI HAT GEWONNEN! üéâ"); else{showToast("Vorbei!");games.forEach(g=>{if(!g.solved){const el=document.getElementById(`sol-${g.id}`);el.innerText=g.word;el.style.display="block";}});} isGameActive=false; }
        }
        function shakeRows(){games.forEach(g=>{if(!g.solved&&g.guesses.length<maxGuesses){const s=g.guesses.length*wordLength;for(let i=0;i<wordLength;i++){const t=document.getElementById(`tile-${g.id}-${s+i}`);t.classList.remove('shake-effect');void t.offsetWidth;t.classList.add('shake-effect');}}});}
        function updateHUD(){ const s=games.filter(g=>g.solved).length; const u=games.length>0?games[0].guesses.length:0; const r=maxGuesses-u; document.getElementById('hud-progress').innerText=`${s} / ${totalGames}`; document.getElementById('hud-guesses').innerText=r; const st=document.getElementById('hud-status-text'); if(r<(totalGames-s)){st.innerText="NICHT SCHAFFBAR";st.className="status-bad";}else{st.innerText="SIEG M√ñGLICH";st.className="status-good";} }
        function updateKeyboardColors(){ games.forEach(g=>{let st={}; g.guesses.forEach(gu=>{const w=g.word.split(''); const u=gu.split(''); let l=new Array(wordLength).fill(1); for(let i=0;i<wordLength;i++)if(u[i]===w[i]){l[i]=3;w[i]=null;u[i]=null;} for(let i=0;i<wordLength;i++)if(u[i]&&w.includes(u[i]))l[i]=2; gu.split('').forEach((c,i)=>{if(l[i]>(st[c]||0))st[c]=l[i];});}); for(const[c,s] of Object.entries(st)){const p=document.getElementById(`pixel-${c}-${g.id}`);if(p)p.style.backgroundColor=(s===3)?'#538d4e':(s===2)?'#b59f3b':(s===1)?'#3a3a3c':'#818384';} }); }

        /* --- LILLY & SCHNECKI & HELPERS (Shortened) --- */
        async function startLillyGame(lang){
            await loadWords(lang); if(cleanWordList.length===0)return; activeMode='lilly'; switchScreen('lilly-area');
            let pangrams=cleanWordList.filter(w=>new Set(w.split('')).size===7); if(pangrams.length===0)return;
            const src=pangrams[Math.floor(Math.random()*pangrams.length)]; const u=Array.from(new Set(src.split('')));
            for(let i=u.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[u[i],u[j]]=[u[j],u[i]];}
            lillyCenter=u[0]; lillyLetters=u; lillyFound=[]; lillyScore=0; maxLillyPoints=0;
            validLillyWords=cleanWordList.filter(w=>{if(w.length<4||!w.includes(lillyCenter))return false; for(let c of w)if(!lillyLetters.includes(c))return false; return true;});
            validLillyWords.forEach(w=>maxLillyPoints+=calcWordScore(w)); renderLillyBoard(); updateLillyScore();
        }
        function renderLillyBoard(){const c=document.getElementById('honeycomb');c.innerHTML='';lillyLetters.forEach((char,i)=>{const b=document.createElement('div');b.className=`hex-btn pos-${i}`;if(i===0)b.classList.add('hex-center');b.innerText=char; b.onclick=()=>lillyType(char); c.appendChild(b);});}
        function lillyType(c){document.getElementById('lilly-input').innerText+=c;}
        function lillyDelete(){let t=document.getElementById('lilly-input').innerText;document.getElementById('lilly-input').innerText=t.slice(0,-1);}
        function shuffleLilly(){let o=lillyLetters.slice(1); for(let i=o.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[o[i],o[j]]=[o[j],o[i]];} lillyLetters=[lillyLetters[0],...o]; renderLillyBoard();}
        function calcWordScore(w){if(w.length===4)return 1;let p=w.length;if(new Set(w.split('')).size===7)p+=7;return p;}
        function lillySubmit(){
            const t=document.getElementById('lilly-input');const w=t.innerText;
            if(w.length<4){showToast("Zu kurz!");return;} if(!w.includes(lillyCenter)){showToast("Muss Gelb enthalten!");return;} if(lillyFound.includes(w)){showToast("Schon gefunden!");t.innerText="";return;}
            if(validLillyWords.includes(w)){const p=calcWordScore(w); lillyFound.push(w); lillyScore+=p; updateLillyScore(); const s=document.createElement('span');s.className='found-word';s.innerText=w; document.getElementById('lilly-words').prepend(s); t.innerText=""; if(lillyFound.length===validLillyWords.length){showToast("üëë ALLES GEFUNDEN! üëë");setTimeout(()=>finishLillyGame(true),1500);}}else{showToast("Nicht in Liste.");t.classList.add('shake-effect');setTimeout(()=>t.classList.remove('shake-effect'),500);}
        }
        function updateLillyScore(){document.getElementById('lilly-score').innerText=`${lillyScore} / ${maxLillyPoints}`;}
        function finishLillyGame(win=false){const m=document.getElementById('results-modal'); document.getElementById('res-header-text').innerText=win?"SUPER LENI HAT GEWONNEN!":"SPIEL BEENDET"; document.getElementById('res-header-text').style.color=win?"#538d4e":"#ffd700"; document.getElementById('res-final-score').innerText=Math.round((lillyScore/maxLillyPoints)*100); document.getElementById('res-max-pts').innerText=maxLillyPoints; document.getElementById('count-found').innerText=lillyFound.length; document.getElementById('count-missed').innerText=validLillyWords.length-lillyFound.length; const lf=document.getElementById('list-found');lf.innerHTML=""; lillyFound.sort().forEach(w=>lf.innerHTML+=`<div class="res-item" style="color:#538d4e;">${w}</div>`); const lm=document.getElementById('list-missed');lm.innerHTML=""; validLillyWords.filter(w=>!lillyFound.includes(w)).sort().forEach(w=>lm.innerHTML+=`<div class="res-item" style="color:#aaa;">${w}</div>`); m.style.display='flex';}
        function showHints(){ let mT={},mR={},ls=new Set(),cs=new Set(),tLR={}; validLillyWords.forEach(w=>{const l=w.length,c=w[0];ls.add(l);cs.add(c);if(!mT[c])mT[c]={};mT[c][l]=(mT[c][l]||0)+1;if(!mR[c])mR[c]={};if(!mR[c][l])mR[c][l]=0;}); validLillyWords.filter(w=>!lillyFound.includes(w)).forEach(w=>{const l=w.length,c=w[0],tc=w.substring(0,2);if(mR[c])mR[c][l]++;tLR[tc]=(tLR[tc]||0)+1;}); const sL=Array.from(ls).sort((a,b)=>a-b);const sC=Array.from(cs).sort(); let h='<table class="hint-table"><thead><tr><th></th>';sL.forEach(l=>h+=`<th>${l}</th>`);h+='<th class="sum-col">Œ£</th></tr></thead><tbody>'; sC.forEach(c=>{h+=`<tr><td class="row-header">${c}</td>`;let rS=0;sL.forEach(l=>{if(mT[c][l]){const n=mR[c][l];rS+=n;h+=`<td>${n===0?"-":n}</td>`;}else h+='<td></td>';});h+=`<td class="sum-col">${rS}</td></tr>`;}); h+='</tbody></table>';document.getElementById('grid-container').innerHTML=h; let tH="";const all2=new Set();validLillyWords.forEach(w=>all2.add(w.substring(0,2))); Array.from(all2).sort().forEach(t=>{const n=tLR[t]||0;const cl=n===0?"two-letter-item two-letter-done":"two-letter-item";tH+=`<div class="${cl}">${t}-${n}</div>`;}); document.getElementById('two-letter-container').innerHTML=tH; document.getElementById('hint-modal').style.display='flex'; }

        async function startSchneckiGame(lang){ await loadWords(lang); if(cleanWordList.length===0)return; activeMode='schnecki'; switchScreen('schnecki-area'); let chars=(lang==='de')?"ENISRATOHLDUGCBM":"ETAOINSHRDLUCMFW"; let base=chars.substring(0,12).split(''); for(let i=base.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[base[i],base[j]]=[base[j],base[i]];} schnLetters=base; schnUsed=new Set(); schnCurrent=""; schnHistory=[]; schnLastIdx=-1; renderSchneckiBoard(); updateSchneckiUI(); }
        function renderSchneckiBoard(){const c=document.getElementById('box-container'); document.querySelectorAll('.box-letter').forEach(el=>el.remove()); document.getElementById('line-layer').innerHTML=''; schnLetters.forEach((char,i)=>{const d=document.createElement('div');d.className=`box-letter bl-${i}`; d.innerText=char;d.id=`s-btn-${i}`;d.onclick=()=>schneckiClick(i);c.appendChild(d);});}
        function schneckiClick(idx){ if(schnLastIdx!==-1){if(Math.floor(idx/3)===Math.floor(schnLastIdx/3)){showToast("Andere Seite w√§hlen!");return;}} if(schnCurrent==="" && schnHistory.length>0){const lastW=schnHistory[schnHistory.length-1]; if(schnLetters[idx]!==lastW.charAt(lastW.length-1)){showToast("Falscher Anfang!");return;}} if(schnLastIdx!==-1) drawLine(schnLastIdx,idx); schnLastIdx=idx; schnCurrent+=schnLetters[idx]; document.querySelectorAll('.box-letter').forEach(el=>el.classList.remove('selected')); document.getElementById(`s-btn-${idx}`).classList.add('selected'); updateSchneckiUI(); }
        function drawLine(f,t){ const l=document.createElementNS('http://www.w3.org/2000/svg','line'); const r1=document.getElementById(`s-btn-${f}`).getBoundingClientRect(); const r2=document.getElementById(`s-btn-${t}`).getBoundingClientRect(); const cr=document.getElementById('box-container').getBoundingClientRect(); l.setAttribute('x1',r1.left-cr.left+15); l.setAttribute('y1',r1.top-cr.top+15); l.setAttribute('x2',r2.left-cr.left+15); l.setAttribute('y2',r2.top-cr.top+15); l.setAttribute('stroke','#333'); l.setAttribute('stroke-width','2'); document.getElementById('line-layer').appendChild(l); }
        function schneckiDelete(){ schnCurrent=""; schnLastIdx=-1; document.getElementById('line-layer').innerHTML=''; document.querySelectorAll('.box-letter').forEach(el=>el.classList.remove('selected')); if(schnHistory.length>0) showToast("Neu ansetzen!"); updateSchneckiUI(); }
        function schneckiSubmit(){ if(schnCurrent.length<3){showToast("Zu kurz!");return;} if(!cleanWordList.includes(schnCurrent)){showToast("Kein Wort!");return;} schnHistory.push(schnCurrent); schnCurrent.split('').forEach(c=>schnUsed.add(c)); schnCurrent=""; schnLastIdx=-1; document.getElementById('line-layer').innerHTML=''; document.querySelectorAll('.box-letter').forEach(el=>el.classList.remove('selected')); updateSchneckiUI(); if(schnUsed.size===12)showToast("üëë SUPER LENI HAT GEWONNEN! üëë"); }
        function updateSchneckiUI(){
    document.getElementById('schnecki-input').innerText = schnCurrent;
    document.getElementById('schnecki-progress').innerText = `${schnUsed.size} von 12 Buchstaben`;
    document.getElementById('schnecki-history-list').innerText = schnHistory.join(" > ") || "Starte!";

    // NEU: F√§rbe die verwendeten Buchstaben gr√ºn
    schnLetters.forEach((char, i) => {
        const btn = document.getElementById(`s-btn-${i}`);
        if(btn) {
            if(schnUsed.has(char)) btn.classList.add('used');
            else btn.classList.remove('used');
        }
    });
}

        /* --- GAME 4: KLOSSIS LECKERLIJAGD (DOTS & BOXES) --- */
        function startKlossiGame(){
            activeMode='klossi'; switchScreen('klossi-area');
            kDots=6; 
            kH_lines=new Array(kDots).fill(0).map(()=>new Array(kDots-1).fill(0));
            kV_lines=new Array(kDots-1).fill(0).map(()=>new Array(kDots).fill(0));
            kBoxes=new Array(kDots-1).fill(0).map(()=>new Array(kDots-1).fill(0));
            
            // Random Map (Schweizer K√§se) - VISIBLE HOLES
            for(let r=0;r<kDots-1;r++)for(let c=0;c<kDots-1;c++)if(Math.random()<0.2)kBoxes[r][c]=-1; 
            
            kTurn=1; kScoreP=0; kScoreB=0; // 1=Player
            
            const cont=document.getElementById('dots-canvas-container');
            const size=Math.min(window.innerWidth-40, 400);
            kScale=size/((kDots-1)*K_SIZE + 20); 
            
            cont.innerHTML=`<canvas id="kCanvas" width="${size}" height="${size}" style="background:#222; cursor:pointer; touch-action:none;"></canvas>`;
            kCanvas=document.getElementById('kCanvas');
            kCtx=kCanvas.getContext('2d');
            kCtx.scale(kScale,kScale);
            kCtx.translate(10,10);
            
            // WICHTIG: POINTER EVENTS (TOUCH & MOUSE)
            kCanvas.addEventListener('pointerdown', klossiClick);
            
            updateKlossiUI(); renderKlossi();
        }

        function klossiClick(e){
            e.preventDefault(); // Stop scroll
            if(kTurn!==1)return; 
            
            const rect=kCanvas.getBoundingClientRect();
            const x=(e.clientX-rect.left)/kScale - 10;
            const y=(e.clientY-rect.top)/kScale - 10;
            
            // Find nearest line
            let col=Math.round(x/K_SIZE), row=Math.floor(y/K_SIZE);
            if(col>=0 && col<kDots && row>=0 && row<kDots-1 && Math.abs(x-col*K_SIZE)<15 && y>row*K_SIZE+10 && y<(row+1)*K_SIZE-10){
                if(kV_lines[row][col]===0) makeMove('v',row,col,1);
                return;
            }
            col=Math.floor(x/K_SIZE); row=Math.round(y/K_SIZE);
            if(row>=0 && row<kDots && col>=0 && col<kDots-1 && Math.abs(y-row*K_SIZE)<15 && x>col*K_SIZE+10 && x<(col+1)*K_SIZE-10){
                if(kH_lines[row][col]===0) makeMove('h',row,col,1);
                return;
            }
        }

        function makeMove(type,r,c,who){
            if(type==='h') kH_lines[r][c]=who; else kV_lines[r][c]=who;
            
            let madePoint=false;
            for(let i=0;i<kDots-1;i++){
                for(let j=0;j<kDots-1;j++){
                    if(kBoxes[i][j]===0){ // Check unowned boxes
                        if(kH_lines[i][j] && kH_lines[i+1][j] && kV_lines[i][j] && kV_lines[i][j+1]){
                            kBoxes[i][j]=who; madePoint=true;
                            if(who===1)kScoreP++; else kScoreB++;
                        }
                    }
                }
            }
            updateKlossiUI(); renderKlossi();
            
            let open=0;
            for(let i=0;i<kDots-1;i++)for(let j=0;j<kDots-1;j++)if(kBoxes[i][j]===0)open++;
            if(open===0){
                if(kScoreP>kScoreB) showToast("SUPER LENI HAT GEWONNEN!");
                else if(kScoreB>kScoreP) showToast("KLO·∫ûI HAT GEWONNEN! JETZT HAT ER EIN LECKERLI VERDIENT!");
                else showToast("UNENTSCHIEDEN!");
                return;
            }

            if(madePoint){
                if(who===2) setTimeout(botMove, 700);
            } else {
                kTurn = (who===1)?2:1;
                updateKlossiUI();
                if(kTurn===2) setTimeout(botMove, 700);
            }
        }

        function botMove(){
            if(activeMode!=='klossi')return;
            // 1. Close Boxes
            let moves=[];
            for(let r=0;r<kDots;r++)for(let c=0;c<kDots-1;c++)if(kH_lines[r][c]===0) moves.push({t:'h',r:r,c:c});
            for(let r=0;r<kDots-1;r++)for(let c=0;c<kDots;c++)if(kV_lines[r][c]===0) moves.push({t:'v',r:r,c:c});
            
            for(let m of moves){
                if(isClosing(m)){ makeMove(m.t, m.r, m.c, 2); return; }
            }
            // 2. Safe Move
            let safeMoves = moves.filter(m => !givesPoint(m));
            if(safeMoves.length>0){
                const m = safeMoves[Math.floor(Math.random()*safeMoves.length)];
                makeMove(m.t, m.r, m.c, 2);
            } else {
                const m = moves[Math.floor(Math.random()*moves.length)];
                makeMove(m.t, m.r, m.c, 2);
            }
        }

        function isClosing(m){
            let closes=false;
            if(m.t==='h') kH_lines[m.r][m.c]=2; else kV_lines[m.r][m.c]=2;
            if(m.t==='h'){
                if(m.r>0 && isBoxFull(m.r-1,m.c)) closes=true;
                if(m.r<kDots-1 && isBoxFull(m.r,m.c)) closes=true;
            } else {
                if(m.c>0 && isBoxFull(m.r,m.c-1)) closes=true;
                if(m.c<kDots-1 && isBoxFull(m.r,m.c)) closes=true;
            }
            if(m.t==='h') kH_lines[m.r][m.c]=0; else kV_lines[m.r][m.c]=0;
            return closes;
        }
        
        function givesPoint(m){
            let bad=false;
            if(m.t==='h'){
                if(m.r>0 && countLines(m.r-1,m.c)===2) bad=true;
                if(m.r<kDots-1 && countLines(m.r,m.c)===2) bad=true;
            } else {
                if(m.c>0 && countLines(m.r,m.c-1)===2) bad=true;
                if(m.c<kDots-1 && countLines(m.r,m.c)===2) bad=true;
            }
            return bad;
        }

        function isBoxFull(r,c){ return kBoxes[r][c]!==-1 && kH_lines[r][c] && kH_lines[r+1][c] && kV_lines[r][c] && kV_lines[r][c+1]; }
        function countLines(r,c){
            if(kBoxes[r][c]===-1) return -1; 
            let cnt=0;
            if(kH_lines[r][c])cnt++; if(kH_lines[r+1][c])cnt++;
            if(kV_lines[r][c])cnt++; if(kV_lines[r][c+1])cnt++;
            return cnt;
        }

        function renderKlossi(){
            kCtx.clearRect(0,0,1000,1000);
            kCtx.lineWidth=4;
            
            // Draw Boxes
            for(let r=0;r<kDots-1;r++){
                for(let c=0;c<kDots-1;c++){
                    if(kBoxes[r][c]===-1) { kCtx.fillStyle='#333'; kCtx.fillRect(c*K_SIZE+5, r*K_SIZE+5, K_SIZE-10, K_SIZE-10); } // Visible Hole
                    else if(kBoxes[r][c]===1) { kCtx.fillStyle='#ff69b4'; kCtx.fillRect(c*K_SIZE, r*K_SIZE, K_SIZE, K_SIZE); }
                    else if(kBoxes[r][c]===2) { kCtx.fillStyle='#ffd700'; kCtx.fillRect(c*K_SIZE, r*K_SIZE, K_SIZE, K_SIZE); }
                }
            }
            // Draw H lines
            for(let r=0;r<kDots;r++)for(let c=0;c<kDots-1;c++){
                if(kH_lines[r][c]){
                    kCtx.beginPath(); kCtx.moveTo(c*K_SIZE, r*K_SIZE); kCtx.lineTo((c+1)*K_SIZE, r*K_SIZE);
                    kCtx.strokeStyle = (kH_lines[r][c]===1)?'#ff69b4':(kH_lines[r][c]===2)?'#ffd700':'#555';
                    kCtx.stroke();
                } else {
                    kCtx.fillStyle='#444'; kCtx.beginPath(); kCtx.arc(c*K_SIZE+K_SIZE/2, r*K_SIZE, 2, 0, 6.28); kCtx.fill();
                }
            }
            // Draw V lines
            for(let r=0;r<kDots-1;r++)for(let c=0;c<kDots;c++){
                if(kV_lines[r][c]){
                    kCtx.beginPath(); kCtx.moveTo(c*K_SIZE, r*K_SIZE); kCtx.lineTo(c*K_SIZE, (r+1)*K_SIZE);
                    kCtx.strokeStyle = (kV_lines[r][c]===1)?'#ff69b4':(kV_lines[r][c]===2)?'#ffd700':'#555';
                    kCtx.stroke();
                } else {
                    kCtx.fillStyle='#444'; kCtx.beginPath(); kCtx.arc(c*K_SIZE, r*K_SIZE+K_SIZE/2, 2, 0, 6.28); kCtx.fill();
                }
            }
            // Draw Dots
            for(let r=0;r<kDots;r++)for(let c=0;c<kDots;c++){
                kCtx.fillStyle='#fff'; kCtx.beginPath(); kCtx.arc(c*K_SIZE, r*K_SIZE, 6, 0, 6.28); kCtx.fill();
            }
        }

        function updateKlossiUI(){
            document.getElementById('score-p').innerText=kScoreP;
            document.getElementById('score-b').innerText=kScoreB;
            document.getElementById('sb-player').className = kTurn===1 ? 'score-box active' : 'score-box';
            document.getElementById('sb-bot').className = kTurn===2 ? 'score-box active' : 'score-box';
            document.getElementById('turn-indicator').innerText = kTurn===1 ? "Du bist dran!" : "Klo√üi denkt...";
        }

        function showToast(txt){const t=document.getElementById('msg-toast');t.innerText=txt;t.style.display='block';setTimeout(()=>t.style.display='none',2000);}
    </script>
</body>
</html>
